% conclusion with future work

\chapter{Conclusion and future work}
\label{chap:conclusion}


The conclusion chapter covers the main finding and the limitations of the work done in this project and ideas future work.







\section{Main findings}
\label{sec:mainfindings}

% How do different spectroscopy data processing influence the qualitative analysis, and how do they affect the quantitative Cliff-Lorimer analysis in HyperSpy

This project on analyzing and trying to improve the analysis of EDS data from SEM.
It has been a learning process for the author, building knowledge for future projects on data drivel analytical work.
For the given studied set-up, some improvements have been apparent.
The project have dealt with how data processing influence both the qualitative and quantitative analysis of EDS data.
The main findings are improvements on calibration of the energy scale, how the background could be modelled better, how the HyperSpy code works and code for direct analysis of EDS data in Python.
The limitations were the authors experience with the topic and the available quantification methods in HyperSpy.


% Calibration
% deviations are small. Se fig Ga-K and the table wit p accuracy
% conclusion: recalibrate would be nice, but not critical
The results from the calibrations examined in this project show that the peak deviations are relatively small, compared to the energy resolution of the detector.
The reported energy resolution of the detector is 127 eV, while the deviations are from 1-20 eV for the best calibration, and 3-50 eV for the built-in calibration of the AZtec software.
Thus, it might be beneficial to recalibrate the energy scale, but it is assumed not to be critical.
Calibration in the SEM APREO at NTNU NanoLab can be changed a few percent to improve the peak accuracy, which could be beneficial for the quantitative analysis.
The calibration should be done with 30 kV spectra with far apart peaks to get clear peaks and little extrapolation.
Calibration was done with Mo L$\alpha$ and Mo K$\alpha$ peaks, but these results were not the best.
It was found that using Ga L$\alpha$ and As K$\alpha$ peaks gave the best results, even though the peaks are not as far apart as the Mo peaks.
This was concluded to be because of the peaks being more well-defined in the GaAs spectrum.
The GaAs calibration was quantified to have three times lower RMS error than the built-in calibration in AZtec.
If a recalibration is done, it would probably be beneficial to take new spectra and calculate the calibration on multiple spectra.
When doing the calibration calculation, HyperSpy provides a good tool, but the calculation could also be done with the code produced in this project, which is more transparent and easier to understand.


% Background as spline
% Not done, but observations imply that it would enhance the bg subtraction and peak fitting, which would improve the quantitative analysis
% modelling spectra to get peak intensities give better area counts than just using a window. ref figure of the model fit and overlapping peaks.
While working with the calibration and model fitting, it was found that the fit of the background as a polynomial tends to be poor at the lower energies, which is where the highest peaks are located.
Modelling the background is a better way to get the peak intensities compared to just using a window around the peaks and raw counts.
The fit of the background is partially poor because the intensity of the background is higher before than after the main peaks in the spectrum.
The main peak or peaks are the highest peaks in the spectrum, which usually are located around 1-3 keV, and this is the area where the intensity and shape of the background is changing the most.
An observed trend is that the background is more linear until the most intense peak, and then after the peak it both drop in intensity and follows the expected background shape.


% How HS works
% sometimes breaks down, but still gives an answer
% working with open-source to know what I am doing, not just using black boxes. How important this is. Issues in AZ is calibration, not labelling Ga Kb, not being able to adjust params
% The HyperSpy Python package is a scientific tool for signal treatment, and the EDS analysis methods in HyperSpy explored in this project have been qualitative analysis, calibration, peak fitting, background subtraction and quantification.
A section of the discussion is covering what steps in HyperSpy was done, and what these steps do.
Working with open-source software allows the user to both understand the steps and alter the analysis to fit the needs of the user.
Even though it can take more time than the black-box software, open-source software gives huge advantages which allowing better results.
Two of the ultimate goals would be to make the quantification in HyperSpy more accurate and to implement SEM EDS data quantification in HyperSpy.
The HyperSpy code needs to be robust and general, which means that the code needs to handle many edge cases.
Implementing absorption and fluorescence correction in HyperSpy is beyond the scope of this project.

% Direct analysis of EDS data in Python. the notebooks which enhance users understanding
In addition to working with the open-source software HyperSpy, the EDS data acquired was analyzed directly in Python.
The Jupyter notebooks used for the analysis are available on GitHub, and the notebooks are a good way to show how the analysis is done.
The steps which are covered in the notebooks are calibration, peak fitting, background subtraction and quantification.
Using the notebooks can enhance the understanding of the analysis, because the notebooks are not made to handle edge cases and are not as general as the HyperSpy code.
This allows the notebooks to be a better tool for understanding the steps in the analysis, while the HyperSpy code is a better tool for general analysis.







% limitations


% data was sampled by an unexperienced user
% time and new materials
The author had little experience with the topic of EDS analysis before the project, both with the analysis and the data acquisition.
Acquiring good EDS spectra does require some experience, which the author did not have before the project.
This is probably the source of the poor quality of the Cu-tape spectra acquired.
In addition, the author did not have deeper knowledge of EDS data analysis when the spectra were taken, which could have made the acquisition better.
Much of the theoretical knowledge of EDS analysis was gained during the project.
In other words, much of the time spent on the project was spent on learning the topic.
Now that the author has more knowledge of the topic, the master thesis project which will be done during the spring of 2023 will benefit of the knowledge gained in this project.


% SEM data analyzed as TEM data
% however, many of the points are uavhengig av om det er SEM eller TEM, eg. calibration, peak fitting, background subtraction, 
% getting good signal-to-noise on SEM 
One of the major limitations, which the author might start to work on during the master thesis project, is the limited quantification methods in HyperSpy for SEM data.
The quantification methods in HyperSpy are made for TEM data, and thus the quantification done in this project is based on some assumptions which are not valid for SEM data.
However, many of the steps in the analysis are independent of the data being SEM or TEM, such as calibration, peak fitting, background subtraction.
Acquiring SEM data with good signal-to-noise ratio gives a good foundation for the analysis, and with the knowledge gained in this project, the author could be able to improve the EDS analysis in a more general way during the master thesis project.













\section{Future work}
\label{sec:futurework}

% Være veldig konkret, gjerne noen superspesifikke greier. eg sjekke NW med høy DT for Mo L-peaks

The aim of this project was to improve EDS analysis by using open-source packages.
For qualitative analysis, this has been achieved for energy calibration and identifying spectral artifacts.
For the qualitative analysis, progress have been made in understanding the fitting of the background with a better model.
Ideas for future work based on the findings of this project are separated into three categories: i) improvements for the current code developed, ii) implementations for HyperSpy and iii) general ideas for future work in EDS analysis.


%%%%%%%%%%%%% Fortsett her


% Improve the current code
% what the data is. dependency on detector angle, and figure out if APREO is good.
i) In the discussion chapter there are multiple ideas for improvements of the current code developed in this project.
One of the ideas is to model the background as a spline, which would improve the background subtraction and peak fitting.
Another idea is to fine tune the peak finder and combine it with the lines in the HyperSpy library, which can improve the peak fitting.
The current spectra can be used, but new spectra with e.g. different beam currents on 30 kV should be taken to analyze the fit of the new spectrum model on different data.
Data with poorer signal-to-noise ratio should also be taken to analyze the effect of the improved model on these types of spectra.
Acquiring data with different dead times would also be interesting, to try to see if artifacts like sum peaks can be treated with data processing.



% Implementations for HyperSpy
% figure out all the methods in HyperSpy. ML tools and other tools which are in TEM HS, and would work with SEM data.
% eventually treat the data with Python and HS, then do quantitative analysis in AZ which have ZAF
ii) Adding quantification methods for SEM data to HyperSpy would be a great improvement of the package.
Much of the basis for the quantification methods in HyperSpy is available in the TEM signal module, thus the needed new code would mainly be the ZAF matrix correction.
Another idea is to get a better overview of all the methods available on TEM data, and figure out which ones work on SEM data.
Then these methods, for example machine learning tools, could be used on SEM data to improve the analysis in AZtec.
In other words, the analysis could be extraction the data from AZtec, applying some methods in HyperSpy and then quantifying the data in AZtec.
This would be a tedious process, but it would allow the user to use the best of both worlds, the open-source software and the closed-source software.
It might also lead to more accurate results, because HyperSpy have methods which are not available in AZtec, which could improve the results.

%  HS plots
ii) Another idea, which would require less work, is to enhance the plotting of models in HyperSpy.
A simple and effective improvement would be to add a legend with explanations to the plots, which would make the plots more understandable.
That would allow the users to see a clearer connection between the spectrum and the listed excitation lines.
Since HyperSpy makes models with the excitation lines, it would be easier to find the strays in the spectrum, because they do not get a line in the model.
One of the advantages with Plotly over Matplotlib is the possibility to hide plotted elements in the plot with a click, allowing the user to see clearer the details of the spectrum.
Making Plotly a possible plotting backend for HyperSpy would be an improvement of the package, and would allow the user to interact with the plots in a more intuitive way.
This change, however, would probably require a lot of work, since the plotting backend is a core part of HyperSpy.


% General ideas for future work in EDS analysis
iii) Some general ideas for future work in EDS analysis emerged during the project.
One of the ideas is to make an optimized workflow for data acquisition.
The data acquired have some flaws, which could be avoided by an optimized workflow.
One of these flaws is the poor quality of the Cu-tape spectra, which could be avoided by an optimized workflow.
Another idea is to figure out better how AZtec calculates the k-factors, because they are a central part of the Cliff-Lorimer quantification method.
This could be done by experimenting with different settings while acquiring data, and then analyzing the effect of the settings on the k-factors.
Another improvement to EDS analysis would be to figure out why the X-ray Data Booklet and the HyperSpy X-ray database have slightly different values for line energies and why some lines are included in one but not the other.
The X-ray Data Booklet lacks a line which is clearly visible in the spectra, which could be a problem for users analyzing their spectra.







% Doing in the master thesis project
For the author's master thesis project, the work with improving EDS analysis will continue, and the ideas from this project will be the starting points.
Improvements on the current code developed in this project will be done, but the main goal will be to contribute to HyperSpy.
Making Jupyter notebooks with examples of how to analyze EDS data is nice and can help a user understand what is happening, but making meaningful contributions to HyperSpy will potentially have a bigger impact.


% finishing remarks



